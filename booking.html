<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Tiket - KCI Fast Train</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800" />
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <!-- Header & Nav -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f4f2f0] px-4 md:px-10 py-3">
          <div class="flex items-center gap-4 text-[#181411]">
            <div class="size-4">
              <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M39.5563 34.1455V13.8546C39.5563 15.708 36.8773 17.3437 32.7927 18.3189C30.2914 18.916 27.263 19.2655 24 19.2655C20.737 19.2655 17.7086 18.916 15.2073 18.3189C11.1227 17.3437 8.44365 15.708 8.44365 13.8546V34.1455C8.44365 35.9988 11.1227 37.6346 15.2073 38.6098C17.7086 39.2069 20.737 39.5564 24 39.5564C27.263 39.5564 30.2914 39.2069 32.7927 38.6098C36.8773 37.6346 39.5563 35.9988 39.5563 34.1455Z" fill="currentColor"></path>
              </svg>
            </div>
            <h2 class="text-[#181411] text-lg font-bold leading-tight tracking-[-0.015em]">RailExpress</h2>
          </div>
          <!-- Mobile menu button -->
          <button id="mobileMenuBtn" class="md:hidden flex flex-col gap-1.5 p-2">
            <span class="block w-6 h-0.5 bg-[#181411]"></span>
            <span class="block w-6 h-0.5 bg-[#181411]"></span>
            <span class="block w-6 h-0.5 bg-[#181411]"></span>
          </button>
          <!-- Desktop navigation -->
          <div class="hidden md:flex flex-1 justify-end gap-8">
            <div class="flex items-center gap-9">
              <a class="text-[#181411] text-sm font-medium leading-normal hover:text-[#e87a30] transition-colors" href="index.html">Home</a>
              <a class="text-[#181411] text-sm font-medium leading-normal hover:text-[#e87a30] transition-colors" href="booking.html">Book</a>
              <a class="text-[#181411] text-sm font-medium leading-normal hover:text-[#e87a30] transition-colors" href="jadwal.html">Destinations</a>
              <a class="text-[#181411] text-sm font-medium leading-normal hover:text-[#e87a30] transition-colors" href="experience.html">Experience</a>
            </div>
            <button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#e87a30] text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#d46a1e] transition-colors sign-in-btn">
              <span class="truncate">Sign In</span>
            </button>
          </div>
          <!-- Mobile navigation -->
          <div id="mobileMenu" class="fixed inset-0 bg-white z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden">
            <div class="flex flex-col h-full">
              <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-[#181411] text-lg font-bold">RailExpress</h2>
                <button id="closeMobileMenu" class="p-2">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
              <nav class="flex flex-col p-4">
                <a class="py-3 text-[#181411] text-base font-medium hover:text-[#e87a30] transition-colors" href="index.html">Home</a>
                <a class="py-3 text-[#181411] text-base font-medium hover:text-[#e87a30] transition-colors" href="booking.html">Book</a>
                <a class="py-3 text-[#181411] text-base font-medium hover:text-[#e87a30] transition-colors" href="jadwal.html">Destinations</a>
                <a class="py-3 text-[#181411] text-base font-medium hover:text-[#e87a30] transition-colors" href="experience.html">Experience</a>
                <button class="mt-4 w-full flex items-center justify-center rounded-lg h-12 bg-[#e87a30] text-white text-base font-bold hover:bg-[#d46a1e] transition-colors sign-in-btn">
                  Sign In
                </button>
              </nav>
            </div>
          </div>
        </header>
        <div class="px-4 md:px-10 lg:px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="@container">
              <div class="@[480px]:p-4">
                <!-- HERO SECTION DIGANTI FORM BOOKING -->
                <div class="flex min-h-[480px] flex-col gap-6 bg-cover bg-center bg-no-repeat @[480px]:gap-8 @[480px]:rounded-lg items-start justify-end px-4 pb-10 @[480px]:px-10 bg-white border border-[#e5dfdc]">
                  <form id="bookingForm" class="w-full max-w-lg mx-auto bg-white rounded-lg shadow-lg p-4 md:p-8 flex flex-col gap-4">
                    <h2 class="text-xl md:text-2xl font-bold text-[#181411] mb-2">Pesan Tiket Kereta Cepat</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="flex flex-col gap-2">
                        <label for="kelas" class="font-medium">Kelas Penumpang</label>
                        <select id="kelas" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors">
                          <option value="">Pilih Kelas</option>
                          <option value="economy">Economy</option>
                          <option value="premium-economy">Premium Economy</option>
                          <option value="business">Business</option>
                          <option value="executive">Executive</option>
                          <option value="luxury">Luxury</option>
                        </select>
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="asal" class="font-medium">Stasiun Keberangkatan</label>
                        <select id="asal" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors">
                          <option value="">Pilih Stasiun</option>
                          <option value="jakarta">Jakarta/Halim</option>
                          <option value="bandung">Bandung (Tegalluar/Bandung Timur/Selatan)</option>
                          <option value="kroya">Kroya (Kabupaten Cilacap, Jawa Tengah)</option>
                          <option value="yogyakarta">Yogyakarta (Kulon Progo/YIA/East Yogyakarta)</option>
                          <option value="solo">Solo (Solo Balapan/Solo Timur)</option>
                          <option value="madiun">Madiun (Jawa Timur)</option>
                          <option value="jombang">Jombang/Kertosono (Jawa Timur)</option>
                          <option value="surabaya">Surabaya (Gubeng/sekitar Surabaya)</option>
                        </select>
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="tujuan" class="font-medium">Stasiun Tujuan</label>
                        <select id="tujuan" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors">
                          <option value="">Pilih Stasiun</option>
                          <option value="jakarta">Jakarta/Halim</option>
                          <option value="bandung">Bandung (Tegalluar/Bandung Timur/Selatan)</option>
                          <option value="kroya">Kroya (Kabupaten Cilacap, Jawa Tengah)</option>
                          <option value="yogyakarta">Yogyakarta (Kulon Progo/YIA/East Yogyakarta)</option>
                          <option value="solo">Solo (Solo Balapan/Solo Timur)</option>
                          <option value="madiun">Madiun (Jawa Timur)</option>
                          <option value="jombang">Jombang/Kertosono (Jawa Timur)</option>
                          <option value="surabaya">Surabaya (Gubeng/sekitar Surabaya)</option>
                        </select>
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="tanggal" class="font-medium">Tanggal Keberangkatan</label>
                        <input type="date" id="tanggal" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" />
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="jumlah" class="font-medium">Jumlah Penumpang</label>
                        <input type="number" id="jumlah" min="1" max="10" value="1" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" />
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="nama" class="font-medium">Nama Lengkap</label>
                        <input type="text" id="nama" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" />
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="email" class="font-medium">Email</label>
                        <input type="email" id="email" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" />
                      </div>
                      <div class="flex flex-col gap-2">
                        <label for="hp" class="font-medium">No. HP</label>
                        <input type="tel" id="hp" required class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" />
                      </div>
                    </div>
                    <!-- Setelah input stasiun tujuan, tambahkan info box di dalam form -->
                    <div id="infoJadwalHarga" class="mt-2 mb-2 text-sm text-[#181411] bg-[#f8f6f4] rounded p-3 flex flex-col gap-2">
                      <div id="hargaTiket" class="text-lg font-bold text-[#e87a30]"></div>
                      <div class="flex flex-col gap-1">
                        <label for="jam" class="font-medium">Jam Keberangkatan</label>
                        <select id="jam" name="jam" class="rounded border border-[#e5dfdc] p-2 focus:ring-2 focus:ring-[#e87a30] focus:border-[#e87a30] transition-colors" required>
                          <option value="">Pilih Jam</option>
                        </select>
                      </div>
                      <div id="estimasiTiba" class="text-[#181411]"></div>
                      <div id="infoKursi" class="text-[#181411]"></div>
                    </div>
                    <button type="submit" class="mt-4 flex items-center justify-center rounded-lg bg-[#e87a30] px-4 py-2 text-white font-bold hover:bg-[#d46a1e] transition-colors w-full md:w-auto">Pesan Tiket</button>
                  </form>
                  <div id="ringkasan" class="w-full max-w-lg mx-auto mt-6 p-4 md:p-8 bg-white rounded-lg shadow-lg"></div>
                </div>
                <!-- END HERO/FORM SECTION -->
              </div>
            </div>
            <!-- Why Choose, Destinations, Offers, dst. -->
          </div>
        </div>
      </div>
    </div>
    <div class="footer">&copy; 2024 KCI Ticket Booking. All rights reserved.</div>
    <!-- Firebase SDK v9+ -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
      const firebaseConfig = {
        apiKey: "AIzaSyAev-NNZsvdUe85kvwQMWlp0X01hdyUd2g",
        authDomain: "kci-r125.firebaseapp.com",
        projectId: "kci-r125",
        storageBucket: "kci-r125.appspot.com",
        messagingSenderId: "526982261911",
        appId: "1:526982261911:web:4bb84b01957c19536f8dd2",
        measurementId: "G-97W13Y37EG"
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      document.getElementById('bookingForm').onsubmit = async function(e) {
        e.preventDefault();
        const kelas = document.getElementById('kelas').value;
        const asal = document.getElementById('asal').value;
        const tujuan = document.getElementById('tujuan').value;
        const tanggal = document.getElementById('tanggal').value;
        const jumlah = document.getElementById('jumlah').value;
        const nama = document.getElementById('nama').value;
        const email = document.getElementById('email').value;
        const hp = document.getElementById('hp').value;
        if (asal === tujuan) {
          alert('Stasiun keberangkatan dan tujuan tidak boleh sama!');
          return;
        }
        if (!kelas || !asal || !tujuan || !tanggal || !jumlah || !nama || !email || !hp) {
          alert('Semua field wajib diisi!');
          return;
        }
        if (new Date(tanggal) < new Date(new Date().toISOString().split('T')[0])) {
          alert('Tanggal tidak boleh lampau!');
          return;
        }
        const bookingId = 'KCI-' + Date.now().toString(36).toUpperCase();
        // Generate nomor kursi (A1, A2, ...)
        let seatNumbers = [];
        for (let i = 1; i <= jumlah; i++) {
          seatNumbers.push('A' + i);
        }
        try {
          await addDoc(collection(db, 'bookings'), {
            bookingId,
            kelas,
            asal,
            tujuan,
            tanggal,
            jumlah,
            nama,
            email,
            hp,
            seatNumbers,
            waktuBooking: new Date().toISOString()
          });
          // Isi modal tiket
          document.getElementById('modalTiketContent').innerHTML = `
            <div>
              <h3 class='text-[#e87a30] font-bold mb-2'>Tiket Digital</h3>
              <ul style='margin-bottom:1rem;'>
                <li><b>No. Booking:</b> ${bookingId}</li>
                <li><b>Nama:</b> ${nama}</li>
                <li><b>Email:</b> ${email}</li>
                <li><b>No. HP:</b> ${hp}</li>
                <li><b>Kelas:</b> ${kelas.replace(/-/g,' ').replace(/\b\w/g, l => l.toUpperCase())}</li>
                <li><b>Asal:</b> ${document.querySelector('#asal option:checked').textContent}</li>
                <li><b>Tujuan:</b> ${document.querySelector('#tujuan option:checked').textContent}</li>
                <li><b>Tanggal:</b> ${tanggal}</li>
                <li><b>Jumlah Penumpang:</b> ${jumlah}</li>
                <li><b>Nomor Kursi:</b> ${seatNumbers.join(', ')}</li>
              </ul>
              <span class='text-green-700 font-semibold'>Booking berhasil!</span>
            </div>
          `;
          document.getElementById('modalTiket').classList.remove('hidden');
          document.getElementById('bookingForm').reset();
        } catch (err) {
          alert('Gagal booking: ' + err.message);
        }
      }
    </script>
    <!-- Tambahkan import jadwal-data.js sebelum script Firebase -->
    <script src="js/jadwal-data.js"></script>
    
    <!-- Tambahkan script update info harga & jadwal -->
    <script>
    function estimasiDurasi(asal, tujuan) {
      // Jakarta-Bandung 45 menit, tiap stasiun berikutnya +1j 30m
      const idxAsal = stasiunList.indexOf(asal);
      const idxTujuan = stasiunList.indexOf(tujuan);
      if (idxAsal === -1 || idxTujuan === -1 || asal === tujuan) return '';
      let jarak = Math.abs(idxTujuan - idxAsal);
      if (jarak === 0) return '';
      let menit = 45 + (jarak - 1) * 90;
      let jam = Math.floor(menit / 60);
      let sisaMenit = menit % 60;
      return jam ? `${jam} jam${sisaMenit ? ' ' + sisaMenit + ' menit' : ''}` : `${sisaMenit} menit`;
    }
    function updateInfoJadwalHarga() {
      const asal = document.getElementById('asal').value;
      const tujuan = document.getElementById('tujuan').value;
      const kelas = document.getElementById('kelas').value;
      const hargaDiv = document.getElementById('hargaTiket');
      const jamSelect = document.getElementById('jam');
      const estimasiDiv = document.getElementById('estimasiTiba');
      const kursiDiv = document.getElementById('infoKursi');
      const jumlah = parseInt(document.getElementById('jumlah').value) || 1;
      if (!asal || !tujuan || asal === tujuan || !kelas) {
        hargaDiv.textContent = '';
        jamSelect.innerHTML = '<option value="">Pilih Jam</option>';
        estimasiDiv.textContent = '';
        kursiDiv.textContent = '';
        return;
      }
      // Cari jadwal
      let jadwal = jadwalData.find(j => j.asal === asal && j.tujuan === tujuan);
      if (!jadwal) jadwal = jadwalData.find(j => j.asal === tujuan && j.tujuan === asal); // Cek arah sebaliknya
      let jamList = jadwal ? jadwal.jam : [];
      // Hitung harga
      let harga = hitungHarga(asal, tujuan, kelas);
      let total = harga * jumlah;
      let totalStr = total ? 'Rp ' + total.toLocaleString('id-ID') : '-';
      hargaDiv.textContent = total ? `Harga Tiket: ${totalStr}` : '';
      // Isi dropdown jam
      jamSelect.innerHTML = '<option value="">Pilih Jam</option>';
      jamList.forEach(jam => {
        const opt = document.createElement('option');
        opt.value = jam;
        opt.textContent = jam;
        jamSelect.appendChild(opt);
      });
      // Estimasi tiba
      const estimasi = estimasiDurasi(asal, tujuan);
      estimasiDiv.textContent = estimasi ? `Estimasi Durasi: ${estimasi}` : '';
      // Info kursi (dummy random)
      kursiDiv.textContent = jamList.length ? `Kursi tersedia: ${Math.floor(Math.random()*81)+20}` : '';
    }
    ['asal','tujuan','kelas','jumlah'].forEach(id => {
      document.getElementById(id).addEventListener('change', updateInfoJadwalHarga);
    });
    document.getElementById('jam').addEventListener('change', function() {
      // Bisa tambahkan fitur lain jika ingin saat jam dipilih
    });
    // Validasi jam sebelum submit
    const bookingForm = document.getElementById('bookingForm');
    if (bookingForm) {
      bookingForm.addEventListener('submit', function(e) {
        const jam = document.getElementById('jam').value;
        if (!jam) {
          alert('Pilih jam keberangkatan!');
          e.preventDefault();
          return false;
        }
      });
    }
    </script>
    <script src="js/mobileMenu.js"></script>
    <script type="module" src="js/auth.js"></script>
    <!-- Modal Tiket Digital -->
    <div id="modalTiket" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 hidden">
      <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative">
        <button id="closeModalTiket" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl">&times;</button>
        <div id="modalTiketContent"></div>
        <button onclick="printTiket()" class="mt-6 w-full flex items-center justify-center rounded-lg bg-red-600 px-4 py-3 text-white font-bold text-lg hover:bg-red-700 transition-colors">Cetak Tiket</button>
      </div>
    </div>
    <script type="module">
    // Modal close logic
    const modalTiket = document.getElementById('modalTiket');
    document.getElementById('closeModalTiket').onclick = function() {
      modalTiket.classList.add('hidden');
    }
    window.onclick = function(event) {
      if (event.target === modalTiket) {
        modalTiket.classList.add('hidden');
      }
    }
    // Print only modal content
    window.printTiket = function() {
      const printContents = document.getElementById('modalTiketContent').innerHTML;
      const originalContents = document.body.innerHTML;
      document.body.innerHTML = printContents;
      window.print();
      document.body.innerHTML = originalContents;
      window.location.reload();
    }
    </script>
  </body>
</html>